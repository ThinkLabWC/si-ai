# AI 챗봇 서비스
### **사용자 관리 및 인증 기능**

**구성요소**

- 사용자(user) 데이터
    - 이메일(string)
    - 패스워드(string)
    - 이름(string)
    - 생성일시(timestampz)
    - 권한(string): 각 사용자는 멤버(`member`) 또는 관리자(`admin`)의 역할

**구현 기능**

- 회원 가입
    - 가입 시 받아야 할 필수 정보: 이메일, 패스워드, 이름
- 로그인
    - 로그인 시 받아야 할 필수 정보: 이메일, 패스워드
    - 로그인 완료 시 JWT(JSON Web Tokens) 형식의 토큰이 발급
- 인증
    - -회원가입 및 로그인을 제외한 모든 요청은 JWT 토큰을 확인하여 인증

### **대화(chat) 관리 기능**

**구성 요소**

- 대화(chat) 데이터
    - 질문(string)
    - 답변(string)
    - 생성일시(timestampz)
    - - 스레드(thread)
  - 응답 생성을 위해 OpenAI에 요청을 전송할 때 지난 대화(chat) 목록을 함께 조회. 
  - 이 목록 단위를 `스레드`라고 정의.
  - 스레드는 각 유저마다 여러 개를 생성 (스레드:회원 = N:1 관계)
  - 스레드 생성 시점
    - 해당 유저의 첫 질문이거나, 마지막 질문 후 30분이 지난 시점에 질문할 경우 생성
    - 해당 유저가 마지막 질문으로부터 30분 이내에 다시 질문할 경우 기존 스레드가 유지

![캡처](/assets/img.webp)

**구현 기능**

- 대화 생성
  - 질문을 입력받고 생성된 답변을 응답
  - 추가 옵션을 파라미터로 전달
    - isStreaming(boolean): `true` 설정될 경우 stream 형태로 응답
    - model(string): 설정될 경우 해당 모델로 응답을 생성
- 대화 목록 조회
  - 요청한 유저의 모든 대화를 응답하는 기능
  - 스레드 단위로 그룹화된 대화의 목록을 응답
  - 각 유저는 자신이 생성한 스레드와 대화만 조회할 수 있으며, 관리자는 모든 스레드와 대화를 조회
  - 생성일시 기준으로 오름차순/내림차순 정렬, 페이지네이션
- 스레드 삭제
  - 특정 스레드를 선택하여 삭제
  - 각 유저는 자신이 생성한 스레드만 삭제

### **사용자 피드백 관리 기능**

**구성 요소**

- 피드백(feedback) 데이터
  - 사용자 ID(string)
  - 대화 ID(string): 피드백 대인 대화의 ID
  - 긍정/부정 유무(boolean)
  - 생성일시(timestampz)
  - 상태(string): `pending`, `resolved` 중 하나

**구현 기능**

- 피드백 생성
  - 특정 대화에 대한 피드백을 생성
  - 각 사용자는 자신이 생성한 대화에만 생성, 관리자는 모든 대화에 대해 피드백 생성
  - 각 사용자는 하나에 대화에 오직 하나의 피드백만 생성, 즉 하나의 대화에는 서로 다른 사용자들이 생성한 n개의 피드백이 존재
- 피드백 목록 조회
  - 각 사용자는 자신이 생성한 피드백만 조회, 관리자 권한의 사용자는 모든 피드백을 조회
  - 생성일시 기준으로 오름차순/내림차순 정렬, 페이지네이션
  - 긍정/부정 유무로 필터링
- 피드백 상태 변경
  - 관리자는 피드백의 상태를 업데이트

### **분석 및 보고 기능**

**구현 기능**

- 사용자 활동 기록 요청
  - 회원가입, 로그인, 대화 생성 수를 응답
  - 요청 시점으로부터 하루 동안의 기록을 응답
  - 해당 기능은 관리자만 요청
- 보고서 생성 요청
  - 호출 시 csv 형태의 보고서를 생성
  - 보고서에는 모든 사용자의 대화 목록과 어떤 사용자가 생성했는지 포함
  - 요청 시점으로부터 하루 동안의 보고서가 생성
  - 해당 기능은 관리자만 요청
  